---
layout: post
title: Understanding ZFS Disk Utilisation and available space
date: 2017-08-16 12:02:07.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Systems (Administration)
tags: []
meta:
  _edit_last: '48492462'
  geo_public: '0'
  _publicize_job_id: '8320377172'
  _elasticsearch_data_sharing_indexed_on: '2024-11-18 14:55:01'
permalink: "/2017/08/16/understanding-zfs-disk-utilisation-and-available-space/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<html><body>
<p>I am hopeful the following will help someone scratch their head a little less in trying to understand the info returned by zfs.</p>
<p>I set up a pool using 4 2TB SATA disks.</p>
<p>[code lang="text"]<br />
$ zpool list -v<br />
NAME SIZE ALLOC FREE EXPANDSZ FRAG CAP DEDUP HEALTH ALTROOT<br />
rpool 7.25T 2.50T 4.75T - 10% 34% 1.00x ONLINE -<br />
raidz2 7.25T 2.50T 4.75T - 10% 34%<br />
sda2 - - - - - -<br />
sdb2 - - - - - -<br />
sdc2 - - - - - -<br />
sdd2 - - - - - -<br />
[/code]</p>
<p>The total size displayed here is the total size of the 4 disks. The maths works as 4*2TB = 8TB = ~7.25TiB</p>
<p>RAIDZ2 is like RAID6 and it uses two disks for parity. Thus, I would expect to have ~4TB or 3.63TiB of available space. I haven't been able to find this number displayed anywhere.</p>
<p><strong>However</strong>, you can find the amount of disk space still available using the following command.</p>
<p>[code]<br />
$# zfs list<br />
NAME USED AVAIL REFER MOUNTPOINT<br />
rpool 1.21T 2.19T 140K /rpool<br />
rpool/ROOT 46.5G 2.19T 140K /rpool/ROOT<br />
rpool/ROOT/pve-1 46.5G 2.19T 46.5G /<br />
rpool/data 1.16T 2.19T 140K /rpool/data<br />
rpool/data/vm-100-disk-1  593M 2.19T  593M -<br />
rpool/data/vm-101-disk-1 87.1G 2.19T 87.1G -<br />
rpool/data/vm-102-disk-1 71.2G 2.19T 71.2G -<br />
rpool/data/vm-103-disk-1 2.26G 2.19T 2.26G -<br />
rpool/data/vm-103-disk-2 13.2M 2.19T 13.2M -<br />
rpool/data/vm-103-disk-3 13.2M 2.19T 13.2M -<br />
rpool/data/vm-103-disk-4   93K 2.19T   93K -<br />
rpool/data/vm-103-disk-5 1015G 2.19T 1015G -<br />
rpool/data/vm-104-disk-1 4.73G 2.19T 4.73G -<br />
rpool/data/vm-105-disk-1 4.16G 2.19T 4.16G -<br />
rpool/swap               8.66G 2.19T 8.66G -<br />
[/code]</p>
<p>The value of <strong>2.19T</strong> is the amount of unallocated space available in the pool. To verify this, you can run</p>
<p>[code]</p>
<p># zfs get all rpool<br />
NAME PROPERTY     VALUE                           SOURCE<br />
rpool type                      filesystem                       -<br />
rpool creation              Fri Aug 4 20:39 2017    -<br />
rpool used                     1.21T                                 -<br />
rpool available             2.19T                                -</p>
<p>...</p>
<p>[/code]</p>
<p>If we add the two numbers here, 1.21T + 2.19T = 3.4T.</p>
<p>5% of disk space is reserved, so 3.63 * 0.95 = 3.4T</p>
<p>et voila</p>
<p></body></html></p>
